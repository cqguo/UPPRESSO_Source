\section{Introduction}
\label{sec:intro}
%SSO的特点
%SSO的现状

%SSO系统的安全问题，需要保护identity proof的完整性，机密性，绑定性
%完整性：使用公开的为受保护的信息作为identity proof
%机密性：保证由IdP发送给对应的RP，并且传输过程中通道、user agent都是受到保护的
%绑定性：identity proof一定要与对应的RP实现绑定
%SPRESSO中关于impersonation和identity injection的描述。 Authentication is the most fundamental security property of an SSO system. That is, i) an adversary should not be able to log in to an RP, and hence, use the service of the RP, as an honest user, and ii) an adversary should not be able to log in the browser of an honest user under an adversary’s identity (identity injection).
%这段描述两个事情：1.secure authentication 就是能防住impersonation和identity injection。 然而，现在有很多攻击使得这两个无法得到保证。经过分析主要是这三个方面的原因：1)RP接受了未被完整性保护的内容；2)未绑定；3)泄露。
%binding 原文描述 ChenPCTKT14 CCS14 Friendcaster(Friendcaster是一款Facebook的第三方应用，比官方版的功能更加全面) blindly accepting an access token received from a user's device then using this token to exchange for the user's Facebook ID. A malicious application could obtain a legitimate access token from a user, then use this access token to log into Friendcaster as the user. cause they thought Facebook's access tokens were bound to relying parties and checked with every API call: \From Facebook's perspective, the API calls wouldn't appear to be originating from Friendcaster, but the attacker's own app."
%完整性原文描述 IEEE S&P2012 \cite{WangCW12}关于Google问题描述we found that the RPs of Google ID SSO often assume that message fields they require Google to sign would always be signed, which turns out to be a serious misunderstanding (Section 4.1). These problems make us believe that a complete answer to our question can only be found by analyzing SSO schemes on real websites.

% Move to section III
%The primary goal of SSO services is to implement secure user authentication \cite{SPRESSO}, i.e., to ensure that an honest user can always log in to an honest RP under the correct account. To achieve this, an identity proof generated by the IdP should explicitly specify the authenticated user (i.e., \emph{user identification}) and the RP to which the user attempts to log in (i.e., \emph{receiver designation}). The identify proof should be received only by that RP and user but not by any other entities (i.e., \emph{confidentiality}) and verified by the receiver (i.e., \emph{integrity}). However, various attacks exploit vulnerabilities in different SSO systems to break at least one of these requirements \cite{ChenPCTKT14, FettKS16,WangCW12,ZhouE14,WangZLG16,YangLLZH16,SomorovskyMSKJ12,MohsenS16}, where the adversaries attempt to either impersonate the victim user at an honest RP or %manipulate the victim user's browser to log in to honest RPs under the adversary's identity. %(i.e., identity injection). For example, Friendcaster was found to accept any received identity proof \cite{ExplicatingSDK,ChenPCTKT14} (i.e., a violation of receiver designation) so that a malicious RP could log in to Friendcaster as the victim user by replaying the identity proof received from the user to Friendcaster \cite{MohsenS16}. \cite{WangCW12} reported that some RPs of Google ID SSO accepted user attributes that were not tied to the identity proof (i.e., a potential violation of integrity). As a result, a malicious user could insert arbitrary attributes (e.g., an email address) into the identity proof to impersonate another user at the RP.


%SSO 引入新的隐私问题
%IdP知道用户登录哪个RP
%RP之间可以合谋知道同一个用户登录哪些RP
Single sign-on (SSO) systems such as OpenID Connect (OIDC) \cite{OpenIDConnect}, OAuth 2.0 \cite{rfc6749} and SAML \cite{SAML},
 are widely deployed in the Internet for identity management and authentication.
 With the help of SSO,
  a user logins to a website, referred to as the \emph{relying party} (RP), using his identity registered at another web service,
   known as the \emph{identity provider} (IdP).
An RP delegates user identification and authentication to the trusted IdP,
    which issues an \emph{identity token} (e.g., id token in OIDC or identity assertion in SAML) for a user to visit the RP after authenticating this user.
Thus, the user keeps only one credential for the IdP, instead of maintaining several credentials for different RPs.
%Moreover, SSO shifts the burden of user authentication from RPs to IdPs and reduces security risks and costs at RPs.
%Besides,
%    the user only manages his attributes at the IdP,
%        but not one copy for each RP.

%SSO has been widely integrated into many application services. For example, 80\% of the Alexa Top-100 websites and 6.3\% of the Alexa Top-1M websites support SSO \cite{GhasemisharifRC18}. Meanwhile, many email and social network providers (such as Google, Facebook, Twitter, etc.) are serving the IdP roles.

The SSO login flow for web applications works as below.
For example, in the widely-used OIDC systems,
     a user sends a login request to the target RP, % (Step 1),
and the RP constructs an identity-token request with its identity (denoted as $ID_{RP}$ in this paper) and redirects the request to the IdP.
After authenticating the user,
 the IdP issues an identity token binding the identities of both the user and the RP (i.e., $ID_U$ and $ID_{RP}$),
    which is returned to the user and forwarded to the RP. %in Step 5.
Finally, the RP verifies the identity token to decide whether the user is allowed to login or not.

%However, SSO systems have been continuously found vulnerable and insecure \cite{WangCW12,ccsSunB12,SomorovskyMSKJ12,ArmandoCCCPS13,DiscoveringJCS,dimvaLiM16,WangZLG16,MainkaMS16, MainkaMSW17,YangLCZ18}.
The wide adoption of SSO raises concerns on user privacy \cite{maler2008venn,NIST2017draft,BrowserID,SPRESSO},
 because SSO facilitates adversaries to track which RPs a user visits.
%As shown in Fig. \ref{fig:OpenID},
In order to issue identity tokens,
in each login instance
 the IdP is always aware of when and to which RP a user attempts to login.
As a result, a curious-but-honest IdP could track all the RPs that each user has visited over time \cite{BrowserID,SPRESSO},
% This data can be further analyzed to profile users' online activities, as in other web tracking attacks.
 called the {\em IdP-based login tracing} in this paper.
%This threat by curious IdPs is also discussed by recent researches .
Meanwhile, the RPs learn users identities from the identity tokens.
    If the IdP encloses a unique user identity in the tokens for a user to visit different RPs \cite{Google, FirefoxAccount},
     collusive RPs could link these login instances across the RPs, %and track the user's activities
      to learn his online profile \cite{maler2008venn}.
We denote this privacy risk as the {\em RP-based identity linkage}.
%This threat is usually mitigated by pairwise pseudonymous identifiers (PPIDs) in practice \cite{NIST2017draft,OpenIDConnect, SAMLIdentifier}.
All existing SSO protocols leak user privacy in different ways,
 and it is worth noting that
    \emph{these two kinds of privacy threats result from the designs of SSO protocols} \cite{NIST2017draft},
     but not any specific implementations of SSO services.

%%As SSO becomes a popular safeguard for various privacy-sensitive web services, the privacy concern is considered more prominent and severe than it was in the past.
%Recently, many IdPs have taken user privacy in SSO into serious consideration and offered new protection against RP-based identity linkage.
%For example, Figure \ref{fig:wechat} shows the IdP service provided by WeChat, one of the most popular instant messaging applications in China.
%It allows a user to create new accounts with new profile attributes to log in to different RPs.
%Similarly, IdPs such as NORDIC APIS and CURITY suggest adopting pairwise pseudonymous identifier (PPID) in SSO \cite{Nordic, Curity},
% and Active Directory Federation Services \cite{MS} and Oracle Access Management \cite{Oracle} support the use of PPID.

%However, these efforts cannot protect users from IdP-based login tracing.
%While privacy-savvy users may provide few personal information to web applications to avoid user tracking or profiling,
% the use of popular SSO services such as Google Account opens a door for IdPs and application providers to recover users' online traces and profiles,
%  which makes users' privacy protection effort in vain.
%Several large IdPs, especially the social IdPs, are known to be interested in collecting users' online behavioral data for various purposes
% (e.g., Screenwise Meter \cite{googlenews} and Onavo \cite{Onavo}).
%Serving the IdP role makes it possible for them to collect such information.
%Finally, privacy-preserving record linkage \cite{agrawal2003information} and
% private set intersection \cite{de2010practical} technologies allow multiple RPs to share data without violating the privacy policies,
% which pave the path for cross-organizational RP-based identity linkage.
%Or even service providers hosting multiple web applications take an advantaged position to correlate users' multiple logins
% at different RPs through internal information integration.
%%%%%%%%%% 注意，我们并不能处理IdP和RP之间的合谋攻击
%
%\begin{figure}[t]
%  \centering
%  \includegraphics[width=0.9\linewidth]{fig/wechat.pdf}
%  \caption{Anonymous SSO login in WeChat.}
%  \label{fig:wechat}
%  \vspace{-5mm}
%\end{figure}

%also raises privacy concerns regarding online user tracking and profiling.
%Imagine that, a user concerning her privacy would avoid to leave her full sensitive information at an application. The user may use multiple web applications and only leave parts of her sensitive messages at each applications, for example, using  real name on social website, the address on shopping website and the phone number on Telecom website. And she would try not to leave any linkable message to avoid applications combining her informations, for example, if she leave the email on each applications, they can combine the parts of informations through the email. However,  the privacy leaks in SSO systems make her effort in vain. As long as a user employs the SSO system, such as Google Account, to log in to these applications, the applications providers and Google can combine your informations based on the SSO account.

%google and facebook的负面新闻
%1. service provider（如DNS）知道你访问了，可以带来很多问题。但是还是不同的，DNS里profile需要评估的是two behavior vectors的similarities，而IdP中都不需要，因为IdP能够区分two behavior vectors 是否来自相同节点。

Several solutions have been proposed to protect user privacy in SSO services \cite{maler2008venn,NIST2017draft,BrowserID,SPRESSO}.
However, to the best of our knowledge,
 {\em none of them provides a practical protection against both the IdP-based login tracing and the RP-based identity linkage}
  (see Sections \ref{subsec-solutions} and \ref{sec:related} for details).
The techniques proposed so far to defend against each of the two threats cannot be integrated,
    for they require modifications to the SSO login flows that essentially conflicts.
This requires a non-trivial re-design of SSO protocols against the threats of user privacy,
%IdP-based login tracing and RP-based identity linkage
while providing secure identity management and authentication.

In this paper,
 we conceptualize the privacy requirements of SSO into
  an {\em identity transformation problem}, %and explain the reasons that limit existing solutions from fully protecting user privacy against both curious IdPs and collusive RPs.
and propose an Untraceable and Unlinkable Privacy-PREserving Single Sign-On (UPPRESSO) protocol
  to comprehensively protect user privacy.
In particular, we design three identity-transformation functions in the SSO login flow.
In each login instance of UPPRESSO,
        $ID_{RP}$ is firstly transformed to an ephemeral $PID_{RP}$  cooperatively by the RP and the user.
Then, $PID_{RP}$ is sent to the IdP to transform $ID_U$ to ephemeral $PID_U$,
    so that the identity token binds $PID_U$ and $PID_{RP}$, instead of permanent $ID_U$ and $ID_{RP}$.
Finally,
    after receiving an identity token with matching $PID_{RP}$,
        the RP transforms $PID_U$ into an account.
Given a user, this account (\emph{a}) is unique at each RP but (\emph{b}) keeps permanent across multiple login instances.
While providing non-anonymous SSO services,
UPPRESSO prevents the IdP from tracking a user's login activities because it receives only $PID_{RP}$ in the identity-token request,
    and collusive RPs from linking a user's accounts across these RPs because every account is unique.
%This prevents both IdP-based login tracing by hiding the RPs' identities from the IdP and RP-based identity linkage by hiding the user's identity from the RPs.
%Meanwhile, an RP is still able to link multiple login sessions of the same user by converting the user's different pseudo-identities to an invariant user account using a special identifier-transformation function and the trapdoors, without knowing the user's real identity in the IdP.
% Finally, we formally prove that the accounts of the same user at different RPs are independent and cannot be correlated by collusive RPs (see our proof in Section \ref{sec:privacy}).
%UPPRESSO designs three one-way identifier-transformation functions based on elliptic curve cryptography. Using the one-way trapdoor function $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}(ID_{RP}, T)$, the RP converts its identity $ID_{RP}$ into a privacy-preserving pseudo-identity $PID_{RP}$ based on a randomly selected trapdoor $T$. Similarly, the IdP uses the one-way function  $\mathcal{F}_{ID_{U} \mapsto PID_{U}}(ID_U, PID_{RP})$ to generate a privacy-preserving pseudo-identity $PID_U$ for the user based on her identity $ID_U$ and $PID_{RP}$. Finally, using a special identifier-transformation function $\mathcal{F}_{PID_{U} \mapsto Account}(PID_U, PID_{RP}, T)$, the RP is able to map all the different privacy-preserving pseudo-identities of a user, which are created in her different login sessions to that RP, to a same $Account$ that identifies the user to the RP. The three identifier-transformation functions work cooperatively to ensure: (\emph{a}) when a user logs in to an RP multiple times, the RP can always map $PID_U$s to a unique $Account$ without knowing the user's identity $ID_U$; moreover, when a user logs in to multiple RPs, (\emph{b}) a curious IdP learns nothing about the identities of these RPs from $PID_{RP}$s, and (\emph{c}) collusive RPs cannot link $PID_U$s to a particular user %or associate them together, (\emph{d}) nor correlate $Account$s of a same user at different RPs.

We summarize our contributions as follows.
%我们的贡献
%提出协议
%考虑能否根据模型进行分析
%实现原型系统
%The main contributions of UPPRESSO are as follows:
\begin{itemize}
\item We formalize the SSO privacy problems as an identity-transformation challenge
    and analyze the limitations of existing privacy-preserving SSO designs.
\item We propose a comprehensive solution to protect the users' login activities against the curious IdP and collusive RPs;
    that is, solve this challenge effectively by designing identity-transformation functions.
To the best of our knowledge, UPPRESSO is the first practical SSO system against both the IdP-based login tracing and the RP-based identity linkage.
%\item We formally prove the privacy of UPPRESSO based on the DDH assumption \cite{GoldwasserK16} and the security of UPPRESSO based on a formal model of the web infrastructure. Our results show that UPPRESSO provides expected and satisfying security and privacy protection to SSO.
%provide the reduction from UPPRESSO scheme to DDH Assumption proving that it is protected from IdP-based login tracing and RP-based identity linkage,
%and analyze the security of UPPRESSO based on a formal model of the web infrastructure and formally prove that it provides satisfying security properties.
\item %UPPRESSO is compatible with existing SSO systems, since it requires only small modifications to support new identifier-transformation functions.
We implement the UPPRESSO prototype system for web applications,
    based on open-source MITREid Connect.
   % We leverage HTML 5 features in the implementation so that it can be used across platforms (e.g., PCs, smartphones, and other devices). %Unlike  BrowserID and SPRESSO,  does not require non-trivial re-designs of SSO services, which makes it more .
The performance evaluations show that UPPRESSO introduces reasonable overheads.
 %We compare the performance of our UPPRESSO prototype with two state-of-the-art SSO systems (i.e., OIDC \cite{OpenIDConnect} and SPRESSO \cite{SPRESSO}) and demonstrate its efficiency.
\end{itemize}

%文章结构
The remainder is organized as follows.
Section \ref{sec:background} presents
    the background and related works.
The identity dilemma of privacy-preserving SSO is analyzed  in Section \ref{sec:challenge},
    and Section \ref{sec:UPPRESSO} presents the detailed designs of UPPRESSO.
The properties of security and privacy are analyzed in Section \ref{sec:analysis}.
We explain the prototype implementation and experimental evaluations in Section \ref{sec:implementation},
 and discuss some extended issues in Section \ref{sec:discussion}.
Section \ref{sec:conclusion} concludes this work.

